# SaveQuest Frontend Architecture Overview

This document provides a high-level overview of the SaveQuest frontend architecture, detailing the key modules, services, and hooks used in the application. It is structured into four main sections: Network/Service Layer, State & Hooks Layer, Utility Layer, and Component Helpers.

### Technology Stack

| Area                   | Pick                                    | Why it helps                                                         |
| ---------------------- | --------------------------------------- | -------------------------------------------------------------------- |
| **HTTP**               | **Axios** single instance               | interceptors → auth & error handling in one spot                     |
| **Data-fetch / cache** | **TanStack Query**                      | eliminates most manual “loading / error / data” plumbing             |
| **Global state**       | **Zustand** (tiny)                      | only for auth token & UI prefs; everything else lives in Query cache |
| **Type-checking**      | **TypeScript**                          | autocompletes swagger types, fewer runtime bugs                      |
| **UI**                 | **React 18 + MUI**                      | fast scaffolding, accessible out of the box                          |
| **Testing**            | Vitest + React Testing Library, Cypress | unit/int → e2e pipeline                                              |



### File Structure

```plaintext
src/
 ├─ api/                 # Network layer
 │   ├─ axios.ts         # Axios instance + interceptors
 │   ├─ plaid.ts         # ↓ auto-generated by openapi-typescript-codegen
 │   ├─ users.ts         #
 │   └─ challenges.ts    #
 │
 ├─ hooks/               # All data hooks wrap TanStack Query
 │   ├─ useAuth.ts
 │   ├─ usePlaid.ts
 │   ├─ useTransactions.ts
 │   ├─ useChallenges.ts
 │   └─ useUser.ts
 │
 ├─ store/               # Zustand slices (tiny)
 │   └─ authStore.ts
 │
 ├─ components/
 │   ├─ plaid/           # Plaid widgets
 │   │   └─ PlaidLinkButton.tsx
 │   ├─ challenges/
 │   │   ├─ ChallengeCard.tsx
 │   │   └─ CheckInButton.tsx
 │   ├─ ui/
 │   │   ├─ Loading.tsx
 │   │   └─ ErrorBoundary.tsx
 │   └─ layout/
 │       └─ AuthGuard.tsx
 │
 ├─ pages/
 │   ├─ Dashboard.tsx
 │   ├─ PlaidConnect.tsx
 │   ├─ Challenges.tsx
 │   └─ Profile.tsx
 │
 ├─ utils/
 │   ├─ dates.ts
 │   ├─ money.ts
 │   └─ plaid.ts         # e.g. name-cleanup helpers
 │
 └─ tests/               # Vitest + RTL
     ├─ api/
     ├─ hooks/
     └─ e2e/             # Cypress
```

## 1 · Network / Service Layer

| Module                                     | Method                | What it does                                          | Params                                             | Returns                                           |
| ------------------------------------------ | --------------------- | ----------------------------------------------------- | -------------------------------------------------- | ------------------------------------------------- |
| **ApiService** (`api/axios.ts`)            | `get`                 | Generic HTTP GET wrapper with auth/error interceptors | `endpoint:string`, `params?:object`                | `Promise<AxiosResponse>`                          |
|                                            | `post`                | Generic HTTP POST                                     | `endpoint:string`, `data?:object`                  | `Promise<AxiosResponse>`                          |
|                                            | `put`                 | Generic HTTP PUT                                      | `endpoint:string`, `data?:object`                  | `Promise<AxiosResponse>`                          |
|                                            | `del`                 | Generic HTTP DELETE                                   | `endpoint:string`                                  | `Promise<AxiosResponse>`                          |
|                                            | `setAuthToken`        | Injects JWT into default headers                      | `token:string \| null`                             | `void`                                            |
|                                            | —                     | —                                                     | —                                                  | —                                                 |
| **PlaidService** (`api/plaid.ts`)          | `createLinkToken`     | Ask backend for a new Plaid Link token                | `userId:string`                                    | `Promise<{link_token:string, expiration:string}>` |
|                                            | `exchangePublicToken` | Swap public token ⇒ access token                      | `publicToken:string`                               | `Promise<{access_token:string,item_id:string}>`   |
|                                            | `getAccounts`         | Fetch accounts via backend passthrough                | `accessToken:string`                               | `Promise<{accounts:any[]}>`                       |
|                                            | `getTransactions`     | Fetch transactions for date range                     | `accessToken:string`, `start:string`, `end:string` | `Promise<{transactions:any[]}>`                   |
|                                            | `initializePlaidLink` | Boot Plaid JS SDK                                     | `linkToken:string`, `onSuccess:fn`, `onExit:fn`    | `PlaidLinkHandler`                                |
|                                            | —                     | —                                                     | —                                                  | —                                                 |
| **UserService** (`api/users.ts`)           | `createUser`          | Register new SaveQuest user                           | `userData:UserInput`                               | `Promise<User>`                                   |
|                                            | `getUser`             | Fetch user profile                                    | `userId:string`                                    | `Promise<User>`                                   |
|                                            | `updateUser`          | Update profile                                        | `userId:string`, `userData:Partial<User>`          | `Promise<User>`                                   |
|                                            | `deleteUser`          | Remove user                                           | `userId:string`                                    | `Promise<void>`                                   |
|                                            | —                     | —                                                     | —                                                  | —                                                 |
| **ChallengeService** (`api/challenges.ts`) | `joinChallenge`       | Add user to a challenge                               | `userId:string`, `challengeId:string`              | `Promise<JoinResult>`                             |
|                                            | `checkInChallenge`    | Daily check-in + verify payment                       | `userId:string`, `challengeId:string`, `date:ISO`  | `Promise<CheckInResult>`                          |
|                                            | `syncTransactions`    | Force backend to pull latest Plaid txns               | `userId:string`                                    | `Promise<{syncedCount:number}>`                   |
|                                            | `getChallengeStatus`  | Current streak & status                               | `userId:string`, `challengeId:string`              | `Promise<ChallengeStatus>`                        |

---

## 2 · State & Hooks Layer

| Hook / Store                         | Method                | Purpose                            | Params                       | Returns                    |         |
| ------------------------------------ | --------------------- | ---------------------------------- | ---------------------------- | -------------------------- | ------- |
| **authStore** (`store/authStore.ts`) | `setToken`            | Save / clear JWT                   | `token:string \| null`       | `void`                     |         |
|                                      | `getState` (auto)     | Snapshot store                     | —                            | \`{token\:string           | null}\` |
| **useAuth**                          | `login`               | Exchange creds for JWT             | `email:string`, `pwd:string` | `Promise<void>`            |         |
|                                      | `logout`              | Clear token + cache                | —                            | `void`                     |         |
|                                      | **hook return**       | `{user, isAuthenticated, loading}` | —                            | object                     |         |
| **usePlaidLink**                     | `createLink` (inside) | Get link\_token then open Plaid UI | —                            | `Promise<void>`            |         |
|                                      | **hook return**       | `{connectAccount}`                 | —                            | object                     |         |
| **useTransactions**                  | —                     | Query cached txns                  | `userId:string`              | `{data, isLoading, error}` |         |
| **useChallenges**                    | `joinChallenge`       | Mutate join                        | `challengeId`                | `Promise<void>`            |         |
|                                      | `checkIn`             | Mutate check-in                    | `challengeId`                | `Promise<void>`            |         |
|                                      | **hook return**       | `{challenges, streaks, loading}`   | —                            | object                     |         |

---

## 3 · Utility Layer

| File              | Function                   | Purpose                 | Params                    | Returns                          |
| ----------------- | -------------------------- | ----------------------- | ------------------------- | -------------------------------- |
| **dates.ts**      | `formatDate`               | Format to `dd-MMM` etc. | `date:Date`, `fmt:string` | `string`                         |
|                   | `isToday`                  | Same-day test           | `date:Date`               | `boolean`                        |
|                   | `getDateRange`             | Last *n* days range     | `days:number`             | `{start:Date,end:Date}`          |
|                   | `parsePlaidDate`           | Plaid `YYYY-MM-DD`→Date | `text:string`             | `Date`                           |
| **money.ts**      | `formatAmount`             | `$1,234.56` builder     | `amount:number`           | `string`                         |
| **plaid.ts**      | `categorizeTransaction`    | Rough tag (“Coffee”)    | `txn:any`                 | `string`                         |
|                   | `isQualifyingForChallenge` | Checks txn vs rules     | `txn:any`, `rules:any`    | `boolean`                        |
| **validation.ts** | `validateEmail`            | Simple regex check      | `email:string`            | `boolean`                        |
|                   | `validateUserId`           | UUID format check       | `uid:string`              | `boolean`                        |
| **errors.ts**     | `parseApiError`            | Axios→friendly object   | `err:any`                 | `{message:string, code?:string}` |
|                   | `getErrorMessage`          | Map code→human text     | `code?:string`            | `string`                         |
|                   | `logError`                 | Send to Sentry/console  | `err:any`,`ctx?:object`   | `void`                           |

---

## 4 · Component Helpers (public handlers only)

| Component           | Handler (method)                             | Purpose / signature |
| ------------------- | -------------------------------------------- | ------------------- |
| **AuthGuard**       | `checkAuthStatus()` → boolean                | redirect gate       |
|                     | `redirectToLogin()` → void                   |                     |
| **PlaidLinkButton** | `handleLinkSuccess(publicToken,meta)` → void | fires exchange      |
|                     | `handleLinkExit(err?,meta)` → void           |                     |
| **ChallengeCard**   | `handleJoinChallenge()` → void               |                     |
|                     | `handleCheckIn()` → void                     |                     |
|                     | `canCheckInToday()` → boolean                |                     |
| **CheckInButton**   | `performCheckIn()` → void                    |                     |
|                     | `validateCheckIn()` → boolean                |                     |


